<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Studio Pro - Multi-Tool Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Client-side Libraries (No API needed) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --premium-blue: #6366f1;
            --premium-purple: #a855f7;
            --bg-dark: #020205;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: var(--bg-dark);
            color: #ffffff;
            overflow-x: hidden;
            position: relative;
        }

        /* Ambient Background Glows */
        body::before {
            content: '';
            position: fixed;
            top: -10%;
            right: -10%;
            width: 40%;
            height: 40%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            z-index: -1;
            pointer-events: none;
        }

        .premium-card {
            background: linear-gradient(145deg, rgba(25, 25, 35, 0.9), rgba(10, 10, 20, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 60px -15px rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(24px);
        }

        .tab-btn {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.5;
        }

        .tab-btn.active {
            color: var(--premium-blue);
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.15);
            opacity: 1;
        }

        .glow-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, #6366f1, #a855f7);
            box-shadow: 0 10px 20px -10px rgba(99, 102, 241, 0.5);
        }

        .glow-button:hover {
            box-shadow: 0 15px 30px -10px rgba(99, 102, 241, 0.7);
            transform: translateY(-2px);
        }

        .waveform-bar {
            background: linear-gradient(to top, var(--premium-blue), var(--premium-purple));
            border-radius: 4px;
        }

        audio {
            filter: invert(100%) hue-rotate(180deg) brightness(1.5);
            height: 38px;
            width: 100%;
        }

        input[type="range"] {
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            height: 4px;
            border-radius: 10px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        /* BRANDING ANIMATION */
        @keyframes float {
            0% { transform: translateY(0px) scale(1); filter: drop-shadow(0 0 0px rgba(99, 102, 241, 0)); }
            50% { transform: translateY(-8px) scale(1.02); filter: drop-shadow(0 5px 15px rgba(99, 102, 241, 0.4)); }
            100% { transform: translateY(0px) scale(1); filter: drop-shadow(0 0 0px rgba(99, 102, 241, 0)); }
        }

        .powered-by {
            animation: float 4s ease-in-out infinite;
            background: linear-gradient(90deg, #94a3b8, #6366f1, #a855f7, #94a3b8);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: 0.1em;
            display: inline-block;
        }

        .loader-ring {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(99, 102, 241, 0.1);
            border-top: 4px solid var(--premium-blue);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 md:p-8 pt-10">

    <!-- Header & Navigation -->
    <div class="w-full max-w-6xl flex flex-col md:flex-row justify-between items-center gap-6 mb-12">
        <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-indigo-500/20">
                <i data-lucide="shield-check" class="text-white w-8 h-8"></i>
            </div>
            <div>
                <h1 class="text-4xl font-black tracking-tighter text-white">VIP STUDIO <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">PRO</span></h1>
                <p class="text-[10px] text-slate-500 font-black uppercase tracking-[0.4em]">Multi-Tool Premium Hub</p>
            </div>
        </div>
        
        <div class="flex bg-white/5 backdrop-blur-xl rounded-2xl p-1.5 border border-white/10 overflow-x-auto max-w-full no-scrollbar">
            <button id="tabAudio" class="tab-btn active px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest flex items-center gap-2 whitespace-nowrap">
                <i data-lucide="mic-2" class="w-4 h-4"></i> Audio
            </button>
            <button id="tabPdf" class="tab-btn px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest flex items-center gap-2 whitespace-nowrap">
                <i data-lucide="file-text" class="w-4 h-4"></i> PDF
            </button>
            <button id="tabImage" class="tab-btn px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest flex items-center gap-2 whitespace-nowrap">
                <i data-lucide="image" class="w-4 h-4"></i> Images
            </button>
            <button id="tabSecurity" class="tab-btn px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest flex items-center gap-2 whitespace-nowrap">
                <i data-lucide="shield-ellipsis" class="w-4 h-4"></i> Security
            </button>
            <button id="tabUtility" class="tab-btn px-6 py-3 rounded-xl text-xs font-black uppercase tracking-widest flex items-center gap-2 whitespace-nowrap">
                <i data-lucide="box" class="w-4 h-4"></i> Utility
            </button>
        </div>
    </div>

    <!-- MAIN SECTIONS -->
    <div class="w-full max-w-6xl flex-grow">

        <!-- 1. AUDIO SECTION -->
        <section id="audioSection" class="space-y-8 animate-in fade-in duration-700">
            <div class="premium-card rounded-[4rem] p-10 md:p-16 text-center border-t border-white/10">
                <div id="audioDrop" class="border-2 border-dashed border-white/5 rounded-[3rem] p-24 hover:bg-white/5 cursor-pointer transition-all group relative overflow-hidden">
                    <div class="absolute inset-0 bg-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <input type="file" id="audioInput" accept="audio/*,video/*" class="hidden">
                    <i data-lucide="music-4" class="w-20 h-20 text-indigo-400 mx-auto mb-8 group-hover:scale-110 transition-transform duration-500"></i>
                    <h2 class="text-3xl font-bold text-white">Audio ya Video Select Karein</h2>
                    <p class="text-slate-500 mt-3 text-lg font-medium">Gap cutting ya Video se High-Quality audio nikalne ke liye.</p>
                </div>

                <div id="audioEditor" class="hidden space-y-12 mt-12 animate-in slide-in-from-bottom-4 duration-700">
                    <div id="visualizer" class="h-40 w-full bg-black/60 rounded-[2.5rem] flex items-center justify-center gap-1.5 px-10 shadow-inner"></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 text-left">
                        <div class="space-y-6">
                            <div class="flex justify-between items-center px-2">
                                <label class="text-sm font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><i data-lucide="zap" class="w-4 h-4 text-indigo-400"></i> Sensitivity</label>
                                <span id="sensVal" class="bg-indigo-500/20 text-indigo-400 px-3 py-1 rounded-lg font-mono text-sm">-45dB</span>
                            </div>
                            <input type="range" id="threshold" min="-70" max="-20" value="-45" class="w-full">
                        </div>
                        <div class="space-y-6">
                            <div class="flex justify-between items-center px-2">
                                <label class="text-sm font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><i data-lucide="volume-2" class="w-4 h-4 text-purple-400"></i> Master Volume</label>
                                <span id="gainVal" class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded-lg font-mono text-sm">100%</span>
                            </div>
                            <input type="range" id="gain" min="100" max="400" step="10" value="100" class="w-full">
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-6">
                        <button id="processAudio" class="glow-button flex-1 py-7 rounded-[2rem] font-black text-2xl text-white tracking-tighter">RENDER VIP AUDIO</button>
                        <button id="extractAudio" class="bg-white/5 border border-white/10 flex-1 py-7 rounded-[2rem] font-black text-2xl text-indigo-400 hover:bg-white/10 transition-all tracking-tighter">EXTRACT MP3 ONLY</button>
                    </div>
                </div>

                <div id="audioResults" class="hidden mt-12 space-y-10 animate-in zoom-in-95 duration-500">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="p-8 bg-white/5 rounded-[2.5rem] text-left border border-white/5">
                            <p class="text-[10px] font-black text-slate-500 mb-5 uppercase tracking-[0.3em]">Before (Source)</p>
                            <audio id="playerBefore" controls></audio>
                        </div>
                        <div class="p-8 bg-indigo-500/5 rounded-[2.5rem] text-left border border-indigo-500/20 shadow-lg shadow-indigo-500/5">
                            <p class="text-[10px] font-black text-indigo-400 mb-5 uppercase tracking-[0.3em]">After (Studio Mastered)</p>
                            <audio id="playerAfter" controls></audio>
                        </div>
                    </div>
                    <a id="audioDownload" href="#" class="glow-button inline-flex px-16 py-6 rounded-2xl text-white font-black text-xl items-center gap-4 transition-transform hover:scale-105">
                        <i data-lucide="download"></i> DOWNLOAD WAV
                    </a>
                </div>
            </div>
        </section>

        <!-- 2. PDF SECTION -->
        <section id="pdfSection" class="hidden space-y-8 animate-in fade-in duration-700">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="premium-card rounded-[3.5rem] p-12 space-y-8 border-t border-white/5">
                    <div class="flex items-center gap-4"><div class="p-3 bg-indigo-500/20 rounded-2xl text-indigo-400"><i data-lucide="file-plus"></i></div><h3 class="text-2xl font-bold">Image to PDF</h3></div>
                    <div onclick="document.getElementById('imgToPdfInput').click()" class="border-2 border-dashed border-white/5 rounded-3xl p-12 text-center hover:bg-white/5 cursor-pointer transition-all">
                        <input type="file" id="imgToPdfInput" accept="image/*" multiple class="hidden">
                        <i data-lucide="plus" class="w-10 h-10 text-slate-600 mx-auto mb-4"></i>
                        <p class="text-sm text-slate-500 font-medium">Select Multiple Images</p>
                        <p id="imgSelectedLabel" class="text-indigo-400 font-bold mt-3 hidden"></p>
                    </div>
                    <button id="btnImgToPdf" class="w-full py-5 rounded-2xl font-black bg-white/5 text-slate-600 transition-all" disabled>GENERATE PDF</button>
                </div>
                <div class="premium-card rounded-[3.5rem] p-12 space-y-8 border-t border-white/5">
                    <div class="flex items-center gap-4"><div class="p-3 bg-purple-500/20 rounded-2xl text-purple-400"><i data-lucide="file-image"></i></div><h3 class="text-2xl font-bold">PDF to PNG</h3></div>
                    <div onclick="document.getElementById('pdfInput').click()" class="border-2 border-dashed border-white/5 rounded-3xl p-12 text-center hover:bg-white/5 cursor-pointer transition-all">
                        <input type="file" id="pdfInput" accept="application/pdf" class="hidden">
                        <i data-lucide="file-up" class="w-10 h-10 text-slate-600 mx-auto mb-4"></i>
                        <p class="text-sm text-slate-500 font-medium">Select PDF File</p>
                        <p id="pdfSelectedLabel" class="text-purple-400 font-bold mt-3 hidden"></p>
                    </div>
                    <button id="btnPdfToImg" class="w-full py-5 rounded-2xl font-black bg-white/5 text-slate-600 transition-all" disabled>EXTRACT PAGES</button>
                </div>
            </div>
            <div id="pdfOutputGallery" class="grid grid-cols-2 md:grid-cols-4 gap-6 hidden mt-8"></div>
        </section>

        <!-- 3. IMAGE SECTION -->
        <section id="imageSection" class="hidden space-y-8 animate-in fade-in duration-700">
            <div class="premium-card rounded-[4rem] p-12 md:p-16 border-t border-white/5">
                <div id="imageDrop" class="border-2 border-dashed border-white/5 rounded-[3rem] p-24 text-center hover:bg-white/5 cursor-pointer transition-all group">
                    <input type="file" id="imageMasterInput" accept="image/*" class="hidden">
                    <i data-lucide="camera" class="w-20 h-20 text-indigo-400 mx-auto mb-8 group-hover:rotate-12 transition-transform duration-500"></i>
                    <h2 class="text-3xl font-bold text-white">Image Editor & Pro Converter</h2>
                    <p class="text-slate-500 mt-3 text-lg">PNG, JPG, WEBP formats with High-End Filters.</p>
                </div>

                <div id="imageEditorUI" class="hidden mt-12 space-y-12 animate-in slide-in-from-bottom-4 duration-700">
                    <div class="flex flex-col md:flex-row gap-12">
                        <div class="flex-1 flex flex-col items-center justify-center p-6 bg-black/60 rounded-[3rem] border border-white/5 overflow-hidden shadow-2xl">
                            <canvas id="filterCanvas" class="max-h-[400px] shadow-2xl"></canvas>
                        </div>
                        <div class="flex-1 space-y-8">
                            <div class="p-8 bg-white/5 rounded-[2.5rem] space-y-8 border border-white/5">
                                <label class="text-xs font-black text-indigo-400 uppercase tracking-[0.3em]">Master Filters</label>
                                <div class="space-y-6">
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center px-1"><span class="text-xs font-bold text-slate-400">BRIGHTNESS</span><span class="text-xs text-indigo-400 font-mono" id="brightVal">100%</span></div>
                                        <input type="range" id="bright" min="0" max="200" value="100" class="w-full">
                                    </div>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center px-1"><span class="text-xs font-bold text-slate-400">CONTRAST</span><span class="text-xs text-indigo-400 font-mono" id="contVal">100%</span></div>
                                        <input type="range" id="contrast" min="0" max="200" value="100" class="w-full">
                                    </div>
                                    <button id="grayToggle" class="w-full py-4 bg-white/5 border border-white/10 rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-white/10 transition-all">GRAYSCALE: OFF</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-6">
                                <div class="space-y-3">
                                    <label class="text-[10px] font-black text-slate-500 tracking-[0.2em] uppercase">Format</label>
                                    <select id="imgFormat" class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl text-sm outline-none font-bold text-white">
                                        <option value="png">PNG</option>
                                        <option value="jpeg">JPG</option>
                                        <option value="webp">WEBP</option>
                                    </select>
                                </div>
                                <div class="space-y-3">
                                    <label class="text-[10px] font-black text-slate-500 tracking-[0.2em] uppercase">Width (px)</label>
                                    <input type="number" id="imgWidth" class="w-full bg-black/40 border border-white/10 p-4 rounded-2xl text-sm outline-none font-mono text-indigo-400">
                                </div>
                            </div>
                            <button id="convertImageBtn" class="glow-button w-full py-7 rounded-[2rem] font-black text-2xl text-white">DOWNLOAD VIP IMAGE</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. SECURITY SECTION -->
        <section id="securitySection" class="hidden space-y-8 animate-in fade-in duration-700">
            <div class="max-w-4xl mx-auto">
                <div class="premium-card rounded-[4rem] p-12 md:p-16 space-y-12 border-t border-white/5">
                    <div class="text-center space-y-4">
                        <div class="w-24 h-24 bg-emerald-500/10 rounded-[2rem] flex items-center justify-center mx-auto shadow-lg shadow-emerald-500/5">
                            <i data-lucide="shield-ellipsis" class="w-12 h-12 text-emerald-400"></i>
                        </div>
                        <h2 class="text-4xl font-bold text-white">VIP Password Generator</h2>
                        <p class="text-slate-500 text-lg">Mahfooz aur random passwords foran generate karein.</p>
                    </div>

                    <div class="space-y-10">
                        <div class="relative group">
                            <input type="text" id="passwordOutput" readonly placeholder="Aapka password..." class="w-full bg-black/60 border border-white/10 p-10 rounded-[3rem] text-3xl font-mono text-emerald-400 outline-none text-center shadow-inner tracking-widest">
                            <button onclick="copyToClipboard('passwordOutput')" class="absolute right-8 top-1/2 -translate-y-1/2 p-5 bg-emerald-500/10 hover:bg-emerald-500/20 rounded-2xl transition-all group-active:scale-95 shadow-xl">
                                <i data-lucide="copy" class="w-7 h-7 text-emerald-400"></i>
                            </button>
                        </div>

                        <div class="p-10 bg-white/5 rounded-[3rem] border border-white/5 space-y-8">
                            <div class="flex justify-between items-center px-4">
                                <label class="text-sm font-black text-slate-400 uppercase tracking-[0.3em]">Password Length</label>
                                <span id="passLenVal" class="text-3xl font-mono text-emerald-400">16</span>
                            </div>
                            <input type="range" id="passLength" min="8" max="32" value="16" class="w-full accent-emerald-500 h-2">
                        </div>

                        <button id="generatePassBtn" class="w-full py-8 rounded-[2.5rem] font-black text-2xl bg-emerald-600 hover:bg-emerald-500 text-white shadow-2xl shadow-emerald-600/30 flex items-center justify-center gap-5 transition-all active:scale-[0.98]">
                            <i data-lucide="refresh-cw" class="w-8 h-8"></i> GENERATE VIP PASSWORD
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. UTILITY SECTION -->
        <section id="utilitySection" class="hidden space-y-8 animate-in fade-in duration-700">
            <div class="max-w-5xl mx-auto">
                <div class="premium-card rounded-[4rem] p-12 md:p-16 space-y-12 border-t border-white/5">
                    <h3 class="text-3xl font-bold flex items-center gap-4"><div class="p-3 bg-indigo-500/20 rounded-2xl text-indigo-400"><i data-lucide="type"></i></div>Text Master (Gap Cleaner)</h3>
                    <textarea id="textUtilInput" placeholder="Apna text yahan likhein (Caption, hashtags wagera)..." class="w-full h-80 bg-black/60 border border-white/10 rounded-[3rem] p-10 outline-none focus:border-indigo-500 text-lg leading-relaxed text-slate-300 shadow-inner"></textarea>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <button onclick="convertText('up')" class="p-6 bg-white/5 rounded-3xl text-sm font-black uppercase tracking-widest hover:bg-white/10 transition-all">UPPERCASE</button>
                        <button onclick="convertText('low')" class="p-6 bg-white/5 rounded-3xl text-sm font-black uppercase tracking-widest hover:bg-white/10 transition-all">lowercase</button>
                        <button onclick="cleanTextGaps()" class="p-6 bg-indigo-600 text-white rounded-3xl text-sm font-black uppercase tracking-widest flex items-center justify-center gap-3 hover:scale-105 transition-all shadow-xl shadow-indigo-500/20">
                            <i data-lucide="align-left" class="w-5 h-5"></i> CLEAN GAPS
                        </button>
                    </div>
                    
                    <div class="flex justify-between items-center px-8 pt-8 border-t border-white/5">
                        <div id="textStats" class="text-[10px] text-slate-500 font-black uppercase tracking-[0.3em] flex gap-10">
                            <span>Words: 0</span><span>Characters: 0</span>
                        </div>
                        <button onclick="copyToClipboard('textUtilInput')" class="text-indigo-400 font-black text-xs uppercase tracking-widest flex items-center gap-3 hover:text-white transition-all">
                            <i data-lucide="copy" class="w-4 h-4"></i> COPY RESULT
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- Powered By Footer -->
    <div class="mt-16 text-center pb-12">
        <span class="powered-by font-black text-xl uppercase italic">Powered by Grow With Haider</span>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-12 left-1/2 -translate-x-1/2 bg-indigo-600 text-white px-10 py-4 rounded-full text-sm font-black uppercase tracking-widest opacity-0 transition-all pointer-events-none shadow-2xl z-50">Copied to Clipboard!</div>

    <script>
        lucide.createIcons();

        // TAB LOGIC
        const tabs = ['Audio', 'Pdf', 'Image', 'Security', 'Utility'];
        tabs.forEach(t => {
            document.getElementById('tab' + t).onclick = () => {
                tabs.forEach(x => {
                    document.getElementById(x.toLowerCase() + 'Section').classList.add('hidden');
                    document.getElementById('tab' + x).classList.remove('active');
                });
                document.getElementById(t.toLowerCase() + 'Section').classList.remove('hidden');
                document.getElementById('tab' + t).classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
        });

        // --- AUDIO TOOLS ---
        const audioInput = document.getElementById('audioInput');
        const audioDrop = document.getElementById('audioDrop');
        const audioEditor = document.getElementById('audioEditor');
        const visualizer = document.getElementById('visualizer');
        const playerBefore = document.getElementById('playerBefore');
        const playerAfter = document.getElementById('playerAfter');
        const audioDownload = document.getElementById('audioDownload');
        let originalBuffer = null;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        audioDrop.onclick = () => audioInput.click();
        document.getElementById('threshold').oninput = (e) => document.getElementById('sensVal').innerText = e.target.value + 'dB';
        document.getElementById('gain').oninput = (e) => document.getElementById('gainVal').innerText = e.target.value + '%';

        audioInput.onchange = async (e) => {
            const file = e.target.files[0]; if(!file) return;
            audioDrop.classList.add('hidden'); audioEditor.classList.remove('hidden');
            playerBefore.src = URL.createObjectURL(file);
            const arrBuf = await file.arrayBuffer();
            originalBuffer = await audioCtx.decodeAudioData(arrBuf);
            drawWave(originalBuffer);
        };

        function drawWave(buffer) {
            visualizer.innerHTML = ''; const data = buffer.getChannelData(0); const bars = 150; const step = Math.floor(data.length / bars);
            for(let i=0; i<bars; i++) {
                let max = 0; for(let j=0; j<step; j++) { let v = Math.abs(data[i*step+j]); if(v>max) max=v; }
                const b = document.createElement('div'); b.className = 'waveform-bar flex-1'; b.style.height = Math.max(10, max * 100) + '%';
                visualizer.appendChild(b);
            }
        }

        document.getElementById('processAudio').onclick = () => runAudioTask(true);
        document.getElementById('extractAudio').onclick = () => runAudioTask(false);

        async function runAudioTask(isCutter) {
            document.getElementById('audioResults').classList.add('hidden');
            const threshold = Math.pow(10, parseFloat(document.getElementById('threshold').value) / 20);
            const gain = parseInt(document.getElementById('gain').value) / 100;
            const sr = originalBuffer.sampleRate; const data = originalBuffer.getChannelData(0); const len = originalBuffer.length;
            let outBuf;
            if(isCutter) {
                const voiceMap = new Uint8Array(len); const win = 256;
                for(let i=0; i<len; i+=win) {
                    let sum = 0; const end = Math.min(i+win, len);
                    for(let j=i; j<end; j++) sum += data[j]*data[j];
                    if(Math.sqrt(sum/win) > threshold) for(let j=i; j<end; j++) voiceMap[j] = 1;
                }
                const segments = []; let inS = false, start = 0;
                for(let i=0; i<len; i++) {
                    if(voiceMap[i] && !inS) { start = i; inS = true; }
                    else if(!voiceMap[i] && inS) { segments.push({s: start, e: i}); inS = false; }
                }
                if(inS) segments.push({s: start, e: len});
                let outLen = 0; segments.forEach(seg => outLen += (seg.e - seg.s));
                outBuf = audioCtx.createBuffer(originalBuffer.numberOfChannels, outLen, sr);
                for(let c=0; c<outBuf.numberOfChannels; c++) {
                    const src = originalBuffer.getChannelData(c), dst = outBuf.getChannelData(c);
                    let off = 0; segments.forEach(seg => {
                        const chunk = src.subarray(seg.s, seg.e);
                        for(let i=0; i<chunk.length; i++) dst[off + i] = Math.max(-1, Math.min(1, chunk[i] * gain));
                        off += chunk.length;
                    });
                }
            } else {
                outBuf = audioCtx.createBuffer(originalBuffer.numberOfChannels, len, sr);
                for(let c=0; c<outBuf.numberOfChannels; c++) {
                    const src = originalBuffer.getChannelData(c), dst = outBuf.getChannelData(c);
                    for(let i=0; i<len; i++) dst[i] = Math.max(-1, Math.min(1, src[i] * gain));
                }
            }
            const wavBlob = encodeWAV(outBuf);
            playerAfter.src = URL.createObjectURL(wavBlob);
            audioDownload.href = playerAfter.src;
            audioDownload.download = "VIP_Studio_Pro.wav";
            document.getElementById('audioResults').classList.remove('hidden');
        }

        function encodeWAV(buf) {
            const nc = buf.numberOfChannels, sr = buf.sampleRate, len = buf.length * nc * 2 + 44;
            const ab = new ArrayBuffer(len), view = new DataView(ab); let p = 0;
            const wS = (s) => { for(let i=0; i<s.length; i++) view.setUint8(p++, s.charCodeAt(i)); };
            const w16 = (v) => { view.setUint16(p, v, true); p += 2; };
            const w32 = (v) => { view.setUint32(p, v, true); p += 4; };
            wS("RIFF"); w32(len - 8); wS("WAVE"); wS("fmt "); w32(16); w16(1); w16(nc);
            w32(sr); w32(sr * nc * 2); w16(nc * 2); w16(16); wS("data"); w32(len - p - 4);
            for (let i = 0; i < buf.length; i++) {
                for (let c = 0; c < nc; c++) {
                    let s = Math.max(-1, Math.min(1, buf.getChannelData(c)[i]));
                    s = s < 0 ? s * 32768 : s * 32767; view.setInt16(p, s, true); p += 2;
                }
            }
            return new Blob([ab], {type: 'audio/wav'});
        }

        // --- IMAGE TOOLS ---
        const filterCanvas = document.getElementById('filterCanvas'); const ctx = filterCanvas.getContext('2d');
        let activeImg = new Image(); let isGray = false;
        document.getElementById('imageDrop').onclick = () => document.getElementById('imageMasterInput').click();
        document.getElementById('imageMasterInput').onchange = (e) => {
            const file = e.target.files[0]; if(!file) return;
            const reader = new FileReader(); reader.onload = (re) => {
                activeImg.src = re.target.result;
                activeImg.onload = () => {
                    document.getElementById('imgWidth').value = activeImg.width;
                    document.getElementById('imageDrop').classList.add('hidden'); document.getElementById('imageEditorUI').classList.remove('hidden');
                    applyFilters();
                };
            };
            reader.readAsDataURL(file);
        };
        function applyFilters() {
            const b = document.getElementById('bright').value, c = document.getElementById('contrast').value;
            const w = parseInt(document.getElementById('imgWidth').value) || activeImg.width; const h = (activeImg.height * w) / activeImg.width;
            document.getElementById('brightVal').innerText = b + '%';
            document.getElementById('contVal').innerText = c + '%';
            filterCanvas.width = w; filterCanvas.height = h;
            ctx.filter = `brightness(${b}%) contrast(${c}%) grayscale(${isGray ? 100 : 0}%)`;
            ctx.drawImage(activeImg, 0, 0, w, h);
        }
        document.getElementById('bright').oninput = applyFilters;
        document.getElementById('contrast').oninput = applyFilters;
        document.getElementById('imgWidth').oninput = applyFilters;
        document.getElementById('grayToggle').onclick = () => {
            isGray = !isGray; document.getElementById('grayToggle').innerText = `GRAYSCALE: ${isGray ? 'ON' : 'OFF'}`; applyFilters();
        };
        document.getElementById('convertImageBtn').onclick = () => {
            const fmt = document.getElementById('imgFormat').value; const link = document.createElement('a');
            link.download = `VIP_Pro_Image.${fmt==='jpeg'?'jpg':fmt}`; link.href = filterCanvas.toDataURL('image/'+fmt); link.click();
        };

        // --- PDF TOOLS ---
        const { jsPDF } = window.jspdf;
        const imgToPdfInput = document.getElementById('imgToPdfInput');
        imgToPdfInput.onchange = () => {
            if(imgToPdfInput.files.length > 0) {
                document.getElementById('imgSelectedLabel').innerText = imgToPdfInput.files.length + " SELECTED";
                document.getElementById('imgSelectedLabel').classList.remove('hidden');
                document.getElementById('btnImgToPdf').disabled = false;
                document.getElementById('btnImgToPdf').classList.add('bg-indigo-600', 'text-white');
            }
        };
        document.getElementById('btnImgToPdf').onclick = async () => {
            const doc = new jsPDF(); const files = Array.from(imgToPdfInput.files);
            for(let i=0; i<files.length; i++) {
                const data = await new Promise(r => { const f = new FileReader(); f.onload = (e) => r(e.target.result); f.readAsDataURL(files[i]); });
                const props = doc.getImageProperties(data); const w = doc.internal.pageSize.getWidth(); const h = (props.height * w) / props.width;
                if(i > 0) doc.addPage(); doc.addImage(data, 'JPEG', 0, 0, w, h);
            }
            doc.save("VIP_Studio_Pro.pdf");
        };
        const pdfInput = document.getElementById('pdfInput');
        pdfInput.onchange = () => {
            if(pdfInput.files[0]) {
                document.getElementById('pdfSelectedLabel').innerText = pdfInput.files[0].name; document.getElementById('pdfSelectedLabel').classList.remove('hidden');
                document.getElementById('btnPdfToImg').disabled = false; document.getElementById('btnPdfToImg').classList.add('bg-purple-600', 'text-white');
            }
        };
        document.getElementById('btnPdfToImg').onclick = async () => {
            const gal = document.getElementById('pdfOutputGallery'); gal.innerHTML = ''; gal.classList.remove('hidden');
            const ab = await pdfInput.files[0].arrayBuffer(); const pdf = await pdfjsLib.getDocument(ab).promise;
            for(let i=1; i<=pdf.numPages; i++) {
                const pg = await pdf.getPage(i); const vp = pg.getViewport({scale: 1.5}); const cv = document.createElement('canvas'); cv.height = vp.height; cv.width = vp.width;
                await pg.render({canvasContext: cv.getContext('2d'), viewport: vp}).promise;
                const div = document.createElement('div'); div.className = "premium-card p-4 rounded-3xl text-center shadow-xl animate-in zoom-in-95";
                div.innerHTML = `<img src="${cv.toDataURL()}" class="rounded-2xl mb-4 shadow-lg"><a href="${cv.toDataURL()}" download="Page_${i}.png" class="text-[10px] font-black uppercase bg-white/10 p-2 rounded-xl hover:bg-white/20">Download Page</a>`;
                gal.appendChild(div);
            }
        };

        // --- SECURITY ---
        document.getElementById('passLength').oninput = (e) => document.getElementById('passLenVal').innerText = e.target.value;
        document.getElementById('generatePassBtn').onclick = () => {
            const len = parseInt(document.getElementById('passLength').value);
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+";
            let pass = ""; const arr = new Uint32Array(len); window.crypto.getRandomValues(arr);
            for(let i=0; i<len; i++) pass += charset.charAt(arr[i] % charset.length);
            document.getElementById('passwordOutput').value = pass;
        };

        // --- UTILITY ---
        const textIn = document.getElementById('textUtilInput');
        textIn.oninput = () => {
            const v = textIn.value.trim();
            document.getElementById('textStats').innerHTML = `<span>Words: ${v ? v.split(/\s+/).length : 0}</span><span>Characters: ${textIn.value.length}</span>`;
        };
        window.cleanTextGaps = () => {
            textIn.value = textIn.value.split('\n').filter(l => l.trim() !== '').join('\n');
            textIn.dispatchEvent(new Event('input')); showToast("Lines Cleaned!");
        };
        window.convertText = (m) => {
            textIn.value = m === 'up' ? textIn.value.toUpperCase() : textIn.value.toLowerCase();
            textIn.dispatchEvent(new Event('input'));
        };

        // Clipboard
        window.copyToClipboard = (id) => {
            const el = document.getElementById(id); if(!el.value) return;
            el.select(); document.execCommand('copy'); showToast("Copied to Clipboard!");
        };

        function showToast(msg) {
            const t = document.getElementById('toast'); t.innerText = msg; t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 2000);
        }
    </script>
</body>
</html>
